@{
    ViewBag.Title = "Dashboard";
}

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Bootstrap 5 CSS -->
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="~/Content/dashboard.css" rel="stylesheet" />
    <!-- responsive adjustments -->
    @*<link href="~/Content/Responsive_Adjustments.css" rel="stylesheet" />*@
    <script src="~/Scripts/jquery-3.7.0.min.js"></script>

</head>
<body>
    <div class="layout-wrapper">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar ebg text-white" aria-hidden="false" aria-label="Main Sidebar">
            <div class="sidebar-header d-flex align-items-center justify-content-between px-3 py-2">
                <h5 class="mb-0 sidebar-title">E-Learning</h5>
                <!-- Floating toggle is used instead of an inline menu button -->
            </div>
            <ul class="list-unstyled px-2 mt-2">
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-speedometer2"></i>
                        @Ajax.ActionLink(
                            "Dashboard",
                            "Dashboard",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-speedometer2"></i>
                        @Ajax.ActionLink(
                            "Students",
                            "Students",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>

                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-journal-bookmark"></i>
                        @Ajax.ActionLink(
                            "Manage Students",
                            "ManageStudent",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>

                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-journal-check"></i>
                        @Ajax.ActionLink(
                            "Payments & Finance",
                            "Payments+Finance",
                            "Student",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-graph-up"></i>
                        @Ajax.ActionLink(
                            "Manage Subjects",
                            "ManageSubject",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>

                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-broadcast-pin"></i>
                        @Ajax.ActionLink(
                            "Manage Batches",
                            "Batches",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-folder"></i>
                        @Ajax.ActionLink(
                            "AppliedTeacher",
                            "AppliedTeacher",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-award"></i>
                        @Ajax.ActionLink(
                            "Course Reviews & Ratings",
                            "CourseReview",
                            "Admin",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>
                <li class="py-2">
                    <p class="mb-0 d-flex align-items-center gap-2 text-white">
                        <i class="bi bi-gear"></i>
                        @Ajax.ActionLink(
                            "Settings",
                            "Settings",
                            "Student",
                            new AjaxOptions
                                 {
                                HttpMethod = "GET",
                                InsertionMode = InsertionMode.Replace,
                                UpdateTargetId = "target"
                            },
                            new { @class = "text-white text-decoration-none nav-text" }
                        )
                    </p>
                </li>


            </ul>


        </aside>
        <!-- Floating Desktop/Mobile Toggle (visible on all screens) -->
        <button id="sidebarFloatToggle" class="sidebar-toggle-btn" aria-label="Toggle sidebar">
            <i id="sidebarFloatIcon" class="bi bi-chevron-double-left"></i>
        </button>
        <!-- Backdrop -->
        <div id="sidebarBackdrop" class="backdrop" hidden></div>
        <!-- Main Content -->
        <main class="content-area">
            <div class="container-fluid">
                <div id="target">
                    @Html.Action("Dashboard","Admin")
                </div>
            </div>
        </main>

    </div>

    <script>
        // Sidebar controls: desktop and mobile (menu button removed)
        const sidebar = document.getElementById("sidebar");
        const floatToggle = document.getElementById("sidebarFloatToggle");
        const floatIcon = document.getElementById("sidebarFloatIcon");
        const backdrop = document.getElementById("sidebarBackdrop");

        function isMobileView() {
            return window.innerWidth < 992;
        }

        // Position the floating toggle so it hugs the sidebar edge
        function positionFloatToggle() {
            if (!floatToggle) return;
            const rect = sidebar.getBoundingClientRect();
            const headerHeight = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) || 65;
            const top = rect.top + headerHeight / 2;
            // place button near the right edge of the sidebar (works both for full and collapsed widths)
            const left = rect.left + rect.width - (floatToggle.offsetWidth / 2);
            floatToggle.style.top = Math.max(8, top) + 'px';
            floatToggle.style.left = Math.max(8, left) + 'px';
        }

        // Desktop & mobile mini toggle handler
        if (floatToggle) {
            floatToggle.addEventListener("click", () => {
                const wasCollapsed = sidebar.classList.toggle("collapsed");
                floatToggle.classList.toggle("collapsed", wasCollapsed);

                // If we collapsed on mobile, ensure the overlay (mobile-open) is closed.
                if (isMobileView()) {
                    sidebar.classList.remove("mobile-open");
                    backdrop.classList.remove("visible");
                    backdrop.hidden = true;
                    document.body.style.overflow = "";
                    sidebar.setAttribute("aria-hidden", "" + !wasCollapsed);
                } else {
                    // desktop: update aria-hidden for accessibility
                    sidebar.setAttribute("aria-hidden", "" + wasCollapsed);
                }

                // reposition after width change
                setTimeout(positionFloatToggle, 200);
            });
        }

        // Close when clicking backdrop
        backdrop.addEventListener("click", () => {
            sidebar.classList.remove("mobile-open");
            backdrop.classList.remove("visible");
            backdrop.hidden = true;
            document.body.style.overflow = "";
            sidebar.setAttribute("aria-hidden", "true");
        });

        // Close sidebar on resize if switching to desktop or mobile; reposition floating toggle
        window.addEventListener("resize", () => {
            if (!isMobileView()) {
                // switch to desktop: ensure overlay closed
                document.body.style.overflow = "";
                sidebar.classList.remove("mobile-open");
                backdrop.classList.remove("visible");
                backdrop.hidden = true;
                // keep collapsed if user set it
                sidebar.setAttribute("aria-hidden", "" + sidebar.classList.contains("collapsed"));
            } else {
                // mobile: keep collapsed state if present (mini strip); don't force-remove it
                if (sidebar.classList.contains("mobile-open")) {
                    sidebar.setAttribute("aria-hidden", "false");
                } else {
                    sidebar.setAttribute("aria-hidden", "" + !sidebar.classList.contains("collapsed"));
                }
            }
            // reposition the floating toggle
            setTimeout(positionFloatToggle, 10);
        });

        // Accessibility: close with Escape when mobile-open
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && sidebar.classList.contains("mobile-open")) {
                sidebar.classList.remove("mobile-open");
                backdrop.classList.remove("visible");
                backdrop.hidden = true;
                document.body.style.overflow = "";
                sidebar.setAttribute("aria-hidden", "true");
            }
        });

        // initial position on load
        window.addEventListener("load", () => {
            setTimeout(positionFloatToggle, 10);
        });

        // also reposition once fonts/icons loaded or after layout changes
        window.addEventListener("DOMContentLoaded", () => setTimeout(positionFloatToggle, 50));
    </script>

    <script>
        /* Keep floating toggle hugging the sidebar while scrolling */
        window.addEventListener('scroll', positionFloatToggle, { passive: true });
    </script>
    @*<script>
    $(document).ready(function () {

        $.ajax({
            url: '@Url.Action("Dashboard", "Admin")',
            type: 'GET',
            success: function (html) {
                $("#target").html(html);   // Show partial view
                console.log("Admin Dashboard Loaded");
            },
            error: function () {
                console.log("Error loading Admin Dashboard");
            }
        });

    });
    </script>*@

</body>
</html>

<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>